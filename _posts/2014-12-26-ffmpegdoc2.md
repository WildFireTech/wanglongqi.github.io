---
author: Longqi
comments: true
date: 2014-12-26 12:53:27
layout: post
slug: ffmpegdoc2
title: ffmpeg的中文文档（二）
categories: [Tools]
tags:
- ffmpeg
- Documents
---
好像这个文档不是很有用的样子，虽然很详细，但是常用的功能介绍也很少。看起来还不如弄个常用命令列表来得给力。不过已经弄完一半多了，索性弄完吧！
**由于内容长度过长，第一部分的内容，[点此查看]({% post_url 2014-12-23-ffmpegdoc %})。**

### 5.3 AVOption选项

这些选项直接由`libavformat`，`libavdevice`和`libavcodec`库提供。要查看可用AVOption的列表，请使用`-help`选项。它们被分为两类：

generic
	这些选项可以为任何容器，编解码器或设备进行设置。通用的选项都列在AVFormatContext选择容器/设备和AVCodecContext选择编解码器小节。

private
	这些选项是作用于给定的容器，装置或编解码器。私有选项列在其相应的容器/设备/编解码器。

比如编辑ID3v2.3头而不是默认的ID3v2.4到MP3文件，使用MP3混合器的`id3v2_version`私有选项：

`ffmpeg -i input.flac -id3v2_version 3 out.mp3`

所有编解码器AVOption选项是按流指定的，并且因此应该指定相应的流标识符。

注： `-nooption`语法不能用于布尔AVOption选项，请使用`-option 0/-option 1` 。

注：老的前缀v/a/s的流标识记号已经过时，将被移除。

### 5.4 主要选项

`-f fmt (input/output)`

强制指定输入或输出的文件格式。输入文件的格式通常是自动检测的，输出文件的格式由该文件的扩展名猜测，所以在大多数情况下不需要此选项。

`-i filename (input)`

输入的文件名

`-y (global)`

直接覆盖输出文件。

`-n (global)`

如果指定的输出文件已经存在，不要覆盖输出文件，并立即退出。

`-c[:stream_specifier] codec (input/output,per-stream)`

`-codec[:stream_specifier] codec (input/output,per-stream)`

用于对一个或多个数据流指定一个编码器（一个输出文件之前使用时）或一个解码器（一个输入文件之前使用时）。 codec是一个解码器/编码器的名称或特殊值copy （仅输出），copy表示该流不是被重新编码。

例如

	`ffmpeg -i INPUT -map 0 -c:v libx264 -c:a copy OUTPUT`
	使用libx264编码所有视频流并拷贝所有音频流。

对于每个数据流，最后匹配的`c`选项被应用，所以

	`ffmpeg -i INPUT -map 0 -c copy -c:v:1 libx264 -c:a:137 libvorbis OUTPUT`
	将复制的所有流除了第二视频流，并将用libx264进行编码，并且对于第138个音频流用libvorbis进行编码。

`-t duration (input/output)`

当作为输入选项（在`-i`之前 ），限制从输入文件中读取数据的`duration`。

当作为输出选项（输出文件名之​​前）使用，在达到`duration`后停止写入输出文件。

`duration`可能是以秒为单位，或以`hh:mm:ss[.xxx]`形式出现。

`-to`和`-t`是相互排斥的，`-t`具有优先权。

`-to position (output)`

在`position`位置停止输出。 `position`可能是一个表示秒数的数，或`hh:mm:ss[.xxx]`形式。

`-to`和`-t`是相互排斥的，`-t`具有优先权。

`-fs limit_size (output)`

设置文件大小限制，以字节表示。

`-ss position (input/output)`

当用作输入选项一起使用（在`-i` 以前），跳转到输入文件中`position` 位置。请注意，在大多数的格式是不可能确切定位，这样ffmpeg将寻求最接近的`position`位置点。当转码和`-accurate_seek`启用（默认设置），寻找点和`position`位置之间的附加段将被解码并丢弃。当进行流复制或当`-noaccurate_seek`被使用时，它都将被保留。

当用作输出选项（在输出文件名​​前），解码但丢弃输入直到时间戳到达的位置。

`position`位置可以是秒数或hh:mm:ss[.xxx]形式。

`-itsoffset offset (input)`

设置输入时间偏移。

`offset`必须是持续时间规范，请参阅（ffmpeg-utils）在FFmpeg-utils（1）手动的持续时间段的相关内容 。

偏移被添加到输入文件的时间戳。指定一个正偏移意味着相应流将延迟offset所指定的时间。

`-timestamp date (output)`

设置在容器内记录的时间戳。

date必须是一个规范的持续时间，请参阅（ffmpeg-utils）在FFmpeg-utils的（1）日期部分 。

`-metadata[:metadata_specifier] key=value (output,per-metadata)`

设置元数据的键/值对。

可选`metadata_specifier`可以被用于设置流或章节的元数据。见`-map_metadata`文档的详细信息。

此选项将覆盖`-map_metadata`设置的元数据。另外，也可以通过使用空值来删除元数据。

	例如，设置输出文件的标题：
	`ffmpeg -i in.avi -metadata title="my title" out.flv`

	设置第一个音频流的语言：
	`ffmpeg -i INPUT -metadata:s:a:0 language=eng OUTPUT`

`-target type (output)`

指定目标文件类型（ vcd ， svcd ， dvd ， dv ， dv50 ）。 类型可能与前缀`pal-` ， `ntsc-`或`film-`使用相应的标准。所有的格式选项（比特率，编解码器，缓冲大小）都将自动设置。你仅需键入：

	`ffmpeg -i myfile.avi -target vcd /tmp/vcd.mpg`

	不过，你可以指定其他选项，只需你知道他们与标准不冲突，如：

	ffmpeg -i myfile.avi -target vcd -bf 2 /tmp/vcd.mpg

`-dframes number (output)`

设置输出数据的帧数。这是`-frames:d`的别名。

`-frames[:stream_specifier] framecount (output,per-stream)`

在`framecount`帧后停止写入流。

`-q[:stream_specifier] q (output,per-stream)`
`-qscale[:stream_specifier] q (output,per-stream)`

使用固定编码率（VBR）。`q/qscale`的意思与编解码器定义相关。如果`qscale`不与`stream_specifier`联用，那么它仅适用于视频流，这是为了保持兼容性。另外将相同的编码器参数赋给两个不同的编解码器通常并不是用户想要的，因此若需要这样的功能，可以使用流标识符(`stream_specifier`)来指定。

`-filter[:stream_specifier] filtergraph (output,per-stream)`

创建由FilterGraph指定的滤镜组并使用它。

FilterGraph是作用于流的滤镜组的描述，而且必须有一个单一的输入和同一类型的数据流输出。

 
在滤镜组里，输入被关联到`in`标签 ，输出到`out`标签 。关于ffmpeg滤镜组的语法可参见ffmpeg-filters的手册。

如果你想创建具有多个输入或输出的滤镜组，参见`-filter_complex`的相关选项。

`-filter_script[:stream_specifier] filename (output,per-stream)`

这个选项类似于`-filter`，唯一的区别是，它的参数是滤镜组所在的文件名。

`-pre[:stream_specifier] preset_name (output,per-stream)`

指定匹配流（S）的预设。

`-stats (global)`

打印编码进度/统计数据。这是默认值，你可通过指定`-nostats`禁用 。

`-progress url (global)`

发送程序友好的进展信息到`url`

进度信息大约每秒和编码过程结束后写入。它是由`key = value`行组成。 key只能包含字母和数字字符。最后一个关键字序列始终是`progress`。

`-stdin`

启用标准输入交互。这是默认设置，除非标准输入被作为输入。要明确禁用互动，你需要指定`-nostdin`。

在标准输入禁用相互作用是很有用的，例如，如果ffmpeg在后台进程组中。大致相同的结果可以用`ffmpeg ... < /dev/null`实现，但它需要一个终端。

`-debug_ts (global)`

打印时间戳信息。它默认是关闭的。此选项主要是用于测试和调试目的，输出格式可从一个版本切换到另一个，所以它不应该在可移植脚本中使用。

参见`-fdebug ts`选项。

`-attach filename (output)`

添加一个附件到输出文件。这仅由几个格式支持。例如Matroska格式，这个文件可以是用来渲染字幕使用的字体。附件被实现为数据流的一个特定类型的，因此该选项将增加一个新的流的文件。因此，可以以通常的方式在此流使用每个流的选​​项。使用此选项创建的附件流将所有的其他流之后创建（也即那些由`-map`或自动映射创建的流）。

请注意，对于Matroska，你还必须设置`mimetype`元数据标签：

	`ffmpeg -i INPUT -attach DejaVuSans.ttf -metadata:s:2 mimetype=application/x-truetype-font out.mkv`
	（假设该附件流将是输出文件的第三个流）。

`-dump_attachment[:stream_specifier] filename (input,per-stream)`

提取匹配的附件流成一个名​​为`filename`的文件​​。如果`filename`​​是空的，那么​​元数据标签中的`filename`标签的值将被使用。

	例如，提取第一附件到“out.ttf”：
	`ffmpeg -dump_attachment:t:0 out.ttf -i INPUT`

	提取所有附件，并按照filename ​标签命名文件：
	`ffmpeg -dump_attachment:t "" -i INPUT`

技术说明 - 附件是通过编解码器额外数据实现的，所以这个选项实际上可以用来提取任意额外数据，而不仅仅是附件。

### 5.5 视频选项

`-vframes number (output)`

设置视频帧的输出数量。这是的`-frames:v`别名 。

`-r[:stream_specifier] fps (input/output,per-stream)`

设置帧速率（Hz值，分数或缩写）。

作为输入选项，忽略存储在文件中的任何时间戳，而是产生时间戳假设恒定的帧速率fps这与一些输入格式，诸如image2或者v4l2，中的`-framerate`选项是不同的（在老版本的ffmpeg中是一样的）。如有疑问，使用的输入选项`-framerate`代替`-r`。

作为输出选项，复制或删除输入帧以达到恒定的输出帧速率fps。

`-s[:stream_specifier] size (input/output,per-stream)`

设置帧尺寸。

作为输入的选项，这是私有选项`video_size`的快捷方式，部分分流器可以识别该参数，这时帧大小或者未存储在文件中或不可配置,例如原始视频或视频采集卡。

作为输出的选择，这将插入`scale`视频滤镜到相应滤镜组的末端 。如需改变滤镜位置，请将`scale`滤镜直接插入到开头或其他地方。

格式是`wxh`（默认值是使用与源相同的尺寸）。

`-aspect[:stream_specifier] aspect (output,per-stream)`

设置指定视频显示的宽高比`aspect`。

`aspect`可以是一个浮点数，或使用形如` num: den `的形式，其中`num`是分子，`den`是分母。例如，“4:3”，“16:9”，“1.3333”，和“1.7777”都是有效的参数值。

如果与`-vcodec copy`一起使用，这会影响储存在容器级别的宽高比，而不是存储在编码帧的宽高比，如果有的话。

`-vn (output)`

禁用视频录制。

`-vcodec codec (output)`

设置视频编解码器。这是-codec:v的别名。

`-pass[:stream_specifier] n (output,per-stream)`

选择通过次数（1或2）。它是用来做两遍视频编码。视频的统计信息记录在第一次编码时写入到日志文件中（也参见选项`-passlogfile`），在第二次编码时，该日志文件被用于按要求生成准确比特率的视频。在第一次编码中，你可以通过禁用音频并将输出设置为null，下面为Windows和Unix的例子：

	`ffmpeg -i foo.mov -c:v libxvid -pass 1 -an -f rawvideo -y NUL`
	`ffmpeg -i foo.mov -c:v libxvid -pass 1 -an -f rawvideo -y /dev/null`

`-passlogfile[:stream_specifier] prefix (output,per-stream)`

设置二次编码的日志文件名 ​​前缀为`prefix` ，默认的文件名 ​​前缀是`ffmpeg2pass`。完整的文件名 ​​将是`PREFIX-N.log`，其中`N`是一个输出流的特定数字

`-vf filtergraph (output)`

创建由`filtergraph`指定的滤镜组，并使用它。

这是`-filter:v`的别名 ，参见`-filter`选项。

### 5.6 高级视频选项
`-pix_fmt[:stream_specifier] format (input/output,per-stream)`

设置的像素格式。使用`-pix_fmts`显示所有支持的像素格式。如果所选择的像素格式不能被选择，ffmpeg将打印警告，并选择由编码器所支持的最好的像素格式。如果`pix_fmt`前缀`+` ，如果请求的像素格式不能被选中，ffmpeg会出现错误退出，同时滤镜组中的自动转换将被禁用。如果`pix_fmt`是一个单一的`+` ，ffmpeg的选择与输入或者滤镜输出相同的像素格式，并将禁用自动转换。

`-sws_flags flags (input/output)`

设置软件缩放的标志。

`-vdt n`

丢弃的阈值。

`-rc_override[:stream_specifier] override (output,per-stream)`

覆盖特定的时间间隔内的帧率控制，格式为用斜杠分隔的“整型，整型，整型”列表。前两个值是在开始和结束帧编号，最后一个如果是正数，则为量化器；负数则为品质因数。

`-ilme`

支持编码器force interlacing（仅对MPEG-2和MPEG-4有效）。如果你的输入文件是隔行并要保持隔行格式最小损失，请使用此选项。另一种方法是使用`-deinterlace`反交错输入流，但这会引入损失。

`-psnr`

计算压缩帧的PSNR（伪信噪比）。

`-vstats`

输出视频编码统计到`vstats_HHMMSS.log`。

`-vstats_file file`

输出频编码统计到`file`。

`-top[:stream_specifier] n (output,per-stream)`

top=1/bottom=0/auto=-1 field first

`-dc precision`

Intra_dc_precision.

`-vtag fourcc/tag (output)`

强制视频 tag/ fourcc。这是`-tag:v`的别名。

`-qphist (global)`

显示QP直方图

`-vbsf bitstream_filter`

已抛弃，见`-bsf`

`-force_key_frames[:stream_specifier] time[,time...] (output,per-stream)`

`-force_key_frames[:stream_specifier] expr:expr (output,per-stream)`

